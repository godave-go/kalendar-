<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="theme-color" content="#1c1c1e" media="(prefers-color-scheme: dark)"/>
  <meta name="theme-color" content="#f5f5f7" media="(prefers-color-scheme: light)"/>
  <title>Kalendar</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #f5f5f7; --bg2: #ebebf0; --card: #ffffff; --card2: #f2f2f7;
      --text: #1d1d1f; --text2: #6e6e73; --text3: #aeaeb2;
      --accent: #e63946; --green: #34c759; --blue: #007aff;
      --purple: #af52de; --orange: #ff9500;
      --border: rgba(0,0,0,0.08);
      --shadow: 0 2px 24px rgba(0,0,0,0.07);
      --radius: 20px; --radius-sm: 14px;
    }
    [data-theme="dark"] {
      --bg: #000000; --bg2: #1c1c1e; --card: #1c1c1e; --card2: #2c2c2e;
      --text: #f5f5f7; --text2: #aeaeb2; --text3: #636366;
      --border: rgba(255,255,255,0.08);
      --shadow: 0 2px 24px rgba(0,0,0,0.5);
    }
    html, body { height: 100%; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
      background: var(--bg); color: var(--text);
      min-height: 100vh;
      padding: env(safe-area-inset-top,12px) 0 env(safe-area-inset-bottom,24px);
      transition: background .3s, color .3s;
      -webkit-tap-highlight-color: transparent;
    }
    .app { max-width: 430px; margin: 0 auto; padding: 0 16px; }

    /* TOP BAR */
    .topbar { display:flex; align-items:center; justify-content:space-between; padding: 16px 0 10px; }
    .topbar-left { display:flex; align-items:center; gap:8px; }
    .topbar-left .flag { font-size:22px; }
    .topbar-left h1 { font-size:19px; font-weight:700; letter-spacing:-.4px; }
    .theme-btn {
      background:var(--card2); border:none; border-radius:50%;
      width:36px; height:36px; font-size:17px; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      transition:transform .15s;
    }
    .theme-btn:active { transform:scale(.88); }

    /* COUNTDOWN HERO */
    .countdown-hero {
      background: linear-gradient(135deg, #e63946 0%, #c1121f 100%);
      border-radius: var(--radius);
      padding: 18px 20px;
      margin: 0 0 14px;
      color: white;
      box-shadow: 0 8px 28px rgba(230,57,70,.35);
      position: relative; overflow: hidden;
    }
    .countdown-hero::before {
      content:''; position:absolute; top:-24px; right:-24px;
      width:100px; height:100px;
      background:rgba(255,255,255,.09); border-radius:50%;
    }
    .countdown-hero::after {
      content:''; position:absolute; bottom:-36px; right:20px;
      width:76px; height:76px;
      background:rgba(255,255,255,.06); border-radius:50%;
    }
    .cd-label { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.8px; opacity:.75; margin-bottom:3px; }
    .cd-name { font-size:19px; font-weight:700; letter-spacing:-.3px; margin-bottom:12px; }
    .cd-timer { display:flex; gap:8px; }
    .timer-block {
      background:rgba(255,255,255,.18); border-radius:10px;
      padding:7px 11px; text-align:center; min-width:50px;
    }
    .timer-num { font-size:24px; font-weight:700; line-height:1; display:block; }
    .timer-unit { font-size:8px; font-weight:700; text-transform:uppercase; letter-spacing:.5px; opacity:.7; margin-top:1px; }
    .cd-date { margin-top:9px; font-size:11px; opacity:.65; }

    /* MOON WIDGET */
    .moon-widget {
      background:var(--card); border-radius:var(--radius-sm);
      padding:14px 16px; margin:0 0 14px;
      display:flex; align-items:center; gap:12px;
      box-shadow:var(--shadow);
    }
    .moon-emoji { font-size:30px; line-height:1; }
    .moon-info { flex:1; }
    .moon-name { font-size:14px; font-weight:600; }
    .moon-desc { font-size:11px; color:var(--text2); margin-top:2px; }
    .moon-pct { font-size:20px; font-weight:700; color:var(--text2); }

    /* NAV */
    .nav { display:flex; align-items:center; justify-content:space-between; padding:2px 0 10px; }
    .nav-btn {
      background:var(--card2); border:none; border-radius:50%;
      width:36px; height:36px; font-size:20px; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      color:var(--text); transition:transform .15s;
    }
    .nav-btn:active { transform:scale(.88); }
    .nav-title { font-size:17px; font-weight:700; letter-spacing:-.3px; }

    /* CALENDAR */
    .calendar-card { background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; margin-bottom:12px; }
    .day-names { display:grid; grid-template-columns:repeat(7,1fr); padding:6px 8px 0; }
    .day-name { text-align:center; font-size:10px; font-weight:700; color:var(--text3); text-transform:uppercase; letter-spacing:.4px; padding:4px 0; }
    .day-name:first-child { color:var(--accent); }
    .days-grid { display:grid; grid-template-columns:repeat(7,1fr); padding:4px 6px 10px; gap:2px; }
    .day-cell {
      aspect-ratio:1; display:flex; flex-direction:column; align-items:center; justify-content:center;
      border-radius:10px; cursor:pointer; position:relative; transition:background .12s;
    }
    .day-cell:active:not(.empty) { transform:scale(.88); }
    .day-cell.empty { cursor:default; opacity:.3; }
    .day-cell.sunday .day-num { color:var(--accent); }
    .day-cell.holiday { background:rgba(230,57,70,.1); }
    .day-cell.religious { background:rgba(175,82,222,.1); }
    .day-cell.today .day-num-wrap {
      background:var(--accent); border-radius:50%;
      width:30px; height:30px; display:flex; align-items:center; justify-content:center;
    }
    .day-cell.today .day-num { color:white !important; font-weight:700; }
    .day-num { font-size:13px; font-weight:500; color:var(--text); line-height:1; }
    .day-dots { display:flex; gap:2px; margin-top:2px; min-height:5px; }
    .dot { width:4px; height:4px; border-radius:50%; }
    .dot-red { background:var(--accent); }
    .dot-purple { background:var(--purple); }
    .dot-blue { background:var(--blue); }

    /* LEGEND */
    .legend { display:flex; gap:14px; padding:0 4px; margin-bottom:16px; flex-wrap:wrap; }
    .legend-item { display:flex; align-items:center; gap:5px; font-size:10px; color:var(--text2); }
    .legend-dot { width:7px; height:7px; border-radius:50%; flex-shrink:0; }

    /* HOLIDAY LIST */
    .section-title { font-size:16px; font-weight:700; letter-spacing:-.2px; margin-bottom:10px; padding:0 2px; }
    .holiday-list { list-style:none; display:flex; flex-direction:column; gap:8px; margin-bottom:32px; }
    .holiday-item {
      background:var(--card); border-radius:var(--radius-sm); padding:12px 14px;
      display:flex; align-items:center; gap:12px;
      box-shadow:var(--shadow); transition:transform .12s;
    }
    .holiday-item:active { transform:scale(.98); }
    .h-color-bar { width:3px; border-radius:2px; align-self:stretch; flex-shrink:0; }
    .h-date { text-align:center; flex-shrink:0; min-width:42px; }
    .h-day { font-size:20px; font-weight:700; line-height:1; }
    .h-month { font-size:10px; font-weight:600; text-transform:uppercase; color:var(--text2); }
    .h-info { flex:1; }
    .h-name { font-size:14px; font-weight:600; }
    .h-desc { font-size:11px; color:var(--text2); margin-top:1px; line-height:1.3; }
    .h-badge { font-size:9px; font-weight:700; padding:2px 7px; border-radius:20px; display:inline-block; margin-top:4px; }
    .badge-nat { background:rgba(230,57,70,.12); color:var(--accent); }
    .badge-rel { background:rgba(175,82,222,.12); color:var(--purple); }
    .h-days { font-size:11px; font-weight:700; color:var(--text3); white-space:nowrap; text-align:right; }
    .h-days.soon { color:var(--orange); }
    .h-days.now { color:var(--green); }

    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }
    .pulse { animation:pulse 2s ease-in-out infinite; }
  </style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="topbar-left">
      <span class="flag">ü¶Ö</span>
      <h1>Kalendar Shqiptar</h1>
    </div>
    <button class="theme-btn" id="themeBtn">üåô</button>
  </div>

  <div class="countdown-hero">
    <div class="cd-label">‚è≥ Festa e ardhshme</div>
    <div class="cd-name" id="cdName">‚Ä¶</div>
    <div class="cd-timer" id="cdTimer"></div>
    <div class="cd-date" id="cdDate"></div>
  </div>

  <div class="moon-widget">
    <div class="moon-emoji" id="moonEmoji">üåï</div>
    <div class="moon-info">
      <div class="moon-name" id="moonName">‚Ä¶</div>
      <div class="moon-desc" id="moonDesc"></div>
    </div>
    <div class="moon-pct" id="moonPct"></div>
  </div>

  <div class="nav">
    <button class="nav-btn" id="prevBtn">&#8249;</button>
    <span class="nav-title" id="navTitle"></span>
    <button class="nav-btn" id="nextBtn">&#8250;</button>
  </div>

  <div class="calendar-card">
    <div class="day-names">
      <div class="day-name">Die</div><div class="day-name">H√´n</div>
      <div class="day-name">Mar</div><div class="day-name">M√´r</div>
      <div class="day-name">Enj</div><div class="day-name">Pre</div>
      <div class="day-name">Sht</div>
    </div>
    <div class="days-grid" id="daysGrid"></div>
  </div>

  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div>Komb√´tare</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div>Fetare</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--blue)"></div>H√´na</div>
  </div>

  <div class="section-title">üìÖ Festat e vitit</div>
  <ul class="holiday-list" id="holidayList"></ul>
</div>

<script>
// THEME
const root = document.documentElement;
const themeBtn = document.getElementById('themeBtn');
let dark = window.matchMedia('(prefers-color-scheme: dark)').matches;
const applyTheme = () => { root.setAttribute('data-theme', dark?'dark':'light'); themeBtn.textContent = dark?'‚òÄÔ∏è':'üåô'; };
applyTheme();
themeBtn.onclick = () => { dark=!dark; applyTheme(); };
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => { dark=e.matches; applyTheme(); });

// DATA
const MN = ['Janar','Shkurt','Mars','Prill','Maj','Qershor','Korrik','Gusht','Shtator','Tetor','N√´ntor','Dhjetor'];
const MS = ['Jan','Shk','Mar','Pri','Maj','Qer','Kor','Gus','Sht','Tet','N√´n','Dhj'];

const NATIONAL = [
  {m:1,d:1,  name:"Viti i Ri",              desc:"Fillimi i vitit t√´ ri"},
  {m:1,d:2,  name:"Viti i Ri (Dita 2)",     desc:"Dita e dyt√´ e Vitit t√´ Ri"},
  {m:3,d:14, name:"Dita e Ver√´s",            desc:"Festa e Ver√´s ‚Äì Sulltan Novruzi"},
  {m:3,d:22, name:"Sulltan Novruzi",         desc:"Festa Bektashiane"},
  {m:5,d:1,  name:"Dita e Pun√´s",            desc:"Festa Nd√´rkomb√´tare e Pun√´tor√´ve"},
  {m:10,d:19,name:"Dita e N√´n√´ Terez√´s",    desc:"P√´rkujtimor i N√´n√´ Terez√´s"},
  {m:11,d:28,name:"Dita e Flamurit",         desc:"Pavar√´sia ‚Äì 28 N√´ntor 1912"},
  {m:11,d:29,name:"√álirimi i Shqip√´ris√´",   desc:"Dita e √álirimit ‚Äì 29 N√´ntor 1944"},
  {m:12,d:8, name:"Dita Komb√´tare e Rinis√´",desc:"Revolucioni Studentor i 1990-s"},
  {m:12,d:25,name:"Krishtlindjet",           desc:"Festa e Krishtlindjes"},
];

// Easter Catholic ‚Äì Gregorian algorithm
function easterCath(y) {
  const a=y%19,b=Math.floor(y/100),c=y%100,d=Math.floor(b/4),e=b%4,f=Math.floor((b+8)/25);
  const g=Math.floor((b-f+1)/3),h=(19*a+b-d-g+15)%30,i=Math.floor(c/4),k=c%4;
  const l=(32+2*e+2*i-h-k)%7,m2=Math.floor((a+11*h+22*l)/451);
  const mo=Math.floor((h+l-7*m2+114)/31), da=((h+l-7*m2+114)%31)+1;
  return new Date(y,mo-1,da);
}

// Easter Orthodox ‚Äì Julian ‚Üí Gregorian (+13 days)
function easterOrtho(y) {
  const a=y%4,b=y%7,c=y%19,d=(19*c+15)%30,e=(2*a+4*b-d+34)%7;
  const mo=Math.floor((d+e+114)/31), da=((d+e+114)%31)+1;
  const date=new Date(y,mo-1,da);
  date.setDate(date.getDate()+13);
  return date;
}

// Islamic approximate dates
const ISL = {
  2024:{fitr:[4,10],kurban:[6,17]}, 2025:{fitr:[3,30],kurban:[6,7]},
  2026:{fitr:[3,20],kurban:[5,27]}, 2027:{fitr:[3,10],kurban:[5,17]},
  2028:{fitr:[2,26],kurban:[5,5]},  2029:{fitr:[2,15],kurban:[4,24]},
  2030:{fitr:[2,4],kurban:[4,14]},
};
function islamicDates(y) {
  const d=ISL[y]||ISL[2025];
  return [
    {date:new Date(y,d.fitr[0]-1,d.fitr[1]),   name:"Fit√´r Bajrami",  desc:"Bajrami i Madh ‚Äì dat√´ e llogaritur"},
    {date:new Date(y,d.kurban[0]-1,d.kurban[1]),name:"Kurban Bajrami", desc:"Festa e Kurban Bajramit ‚Äì dat√´ e llogaritur"},
  ];
}

function getReligious(y) {
  return [
    {date:easterCath(y),  name:"Pashk√´t Katolike",  desc:"Ngjallimi ‚Äì llogaritje automatike"},
    {date:easterOrtho(y), name:"Pashk√´t Ortodokse", desc:"Pashk√´t ‚Äì llogaritje automatike"},
    ...islamicDates(y),
  ];
}

function allHolidays(y) {
  const nat = NATIONAL.map(h=>({date:new Date(y,h.m-1,h.d), name:h.name, desc:h.desc, type:'nat'}));
  const rel = getReligious(y).map(h=>({...h, type:'rel'}));
  return [...nat,...rel].sort((a,b)=>a.date-b.date);
}

// Moon phase
function moonPhase(date) {
  const known=new Date(2000,0,6,18,14), syn=29.53058867;
  let age=((date-known)/86400000)%syn;
  if(age<0)age+=syn;
  const pct=Math.round(age/syn*100);
  const emojis=[
    [1,'üåë','H√´na e Re','Fillimi i ciklit t√´ ri'],
    [7.38,'üåí','Gjysm√´h√´na Lind√´se','H√´na po rritet'],
    [9.22,'üåì','√áereku i Par√´','Gjysma e h√´n√´s duket'],
    [14.77,'üåî','Gung√´ze Rrit√´se','Gati e plot√´'],
    [16.61,'üåï','H√´na e Plot√´','Nat√´ e ndri√ßuar!'],
    [22.15,'üåñ','Gung√´ze Zvog√´luese','H√´na zvog√´lohet'],
    [23.99,'üåó','√áereku i Fundit','Gjysma tjet√´r duket'],
    [29.53,'üåò','Gjysm√´h√´na Per√´ndimore','Cikli po mbaron'],
  ];
  for(const [lim,em,name,desc] of emojis) if(age<lim) return {emoji:em,name,desc,pct,age:Math.round(age)};
  return {emoji:'üåë',name:'H√´na e Re',desc:'Cik√´l i ri',pct,age:0};
}

// STATE
const today=new Date();
let vY=today.getFullYear(), vM=today.getMonth();

// COUNTDOWN
function startCountdown() {
  const lists=[allHolidays(today.getFullYear()),allHolidays(today.getFullYear()+1)];
  const merged=[...lists[0],...lists[1]];
  const next=merged.find(h=>h.date>=today);
  if(!next)return;
  document.getElementById('cdName').textContent=next.name;
  document.getElementById('cdDate').textContent='üìÖ '+String(next.date.getDate()).padStart(2,'0')+' '+MN[next.date.getMonth()]+' '+next.date.getFullYear();
  function tick(){
    const diff=next.date-new Date();
    if(diff<0){startCountdown();return;}
    const D=Math.floor(diff/86400000),H=Math.floor(diff%86400000/3600000),
          Mi=Math.floor(diff%3600000/60000),S=Math.floor(diff%60000/1000);
    document.getElementById('cdTimer').innerHTML=
      `<div class="timer-block"><span class="timer-num">${String(D).padStart(2,'0')}</span><div class="timer-unit">Dit√´</div></div>`+
      `<div class="timer-block"><span class="timer-num">${String(H).padStart(2,'0')}</span><div class="timer-unit">Or√´</div></div>`+
      `<div class="timer-block"><span class="timer-num">${String(Mi).padStart(2,'0')}</span><div class="timer-unit">Min</div></div>`+
      `<div class="timer-block"><span class="timer-num">${String(S).padStart(2,'0')}</span><div class="timer-unit">Sek</div></div>`;
  }
  tick();
  clearInterval(window._cd);
  window._cd=setInterval(tick,1000);
}

// MOON
function renderMoon(){
  const m=moonPhase(today);
  document.getElementById('moonEmoji').textContent=m.emoji;
  document.getElementById('moonName').textContent=m.name;
  document.getElementById('moonDesc').textContent=m.desc;
  document.getElementById('moonPct').textContent=m.pct+'%';
}

// BUILD HOLIDAY MAP
function buildMap(y){
  const map={};
  allHolidays(y).forEach(h=>{
    const k=`${h.date.getMonth()}-${h.date.getDate()}`;
    (map[k]=map[k]||[]).push(h);
  });
  return map;
}

// RENDER CALENDAR
function render(){
  document.getElementById('navTitle').textContent=MN[vM]+' '+vY;
  const map=buildMap(vY);
  const firstDay=new Date(vY,vM,1).getDay();
  const daysInMonth=new Date(vY,vM+1,0).getDate();
  const grid=document.getElementById('daysGrid');
  grid.innerHTML='';

  for(let i=0;i<firstDay;i++){
    const c=document.createElement('div');
    c.className='day-cell empty';
    c.innerHTML='<div class="day-num-wrap"><div class="day-num"></div></div>';
    grid.appendChild(c);
  }

  for(let d=1;d<=daysInMonth;d++){
    const dow=new Date(vY,vM,d).getDay();
    const hs=map[`${vM}-${d}`]||[];
    const isToday=d===today.getDate()&&vM===today.getMonth()&&vY===today.getFullYear();
    const hasNat=hs.some(h=>h.type==='nat');
    const hasRel=hs.some(h=>h.type==='rel');
    const mp=moonPhase(new Date(vY,vM,d));
    const isMoon=mp.age<=1||(mp.age>=14&&mp.age<=16);

    const c=document.createElement('div');
    let cls='day-cell';
    if(dow===0)cls+=' sunday';
    if(hasNat)cls+=' holiday';
    if(hasRel)cls+=' religious';
    if(isToday)cls+=' today';
    c.className=cls;
    c.innerHTML=`<div class="day-num-wrap"><div class="day-num">${d}</div></div>
      <div class="day-dots">
        ${hasNat?'<div class="dot dot-red"></div>':''}
        ${hasRel?'<div class="dot dot-purple"></div>':''}
        ${isMoon?'<div class="dot dot-blue"></div>':''}
      </div>`;
    grid.appendChild(c);
  }

  // Holiday list
  const list=document.getElementById('holidayList');
  list.innerHTML='';
  allHolidays(vY).forEach(h=>{
    const diff=Math.ceil((h.date-today)/86400000);
    const li=document.createElement('li');
    li.className='holiday-item';
    const color=h.type==='rel'?'var(--purple)':'var(--accent)';
    const badge=h.type==='rel'?'Fetare':'Komb√´tare';
    const badgeCls=h.type==='rel'?'badge-rel':'badge-nat';
    let dStr='', dCls='h-days';
    if(diff===0){dStr='üü¢ Sot!';dCls+=' now pulse';}
    else if(diff>0&&diff<=7){dStr=diff+' dit√´';dCls+=' soon';}
    else if(diff>0){dStr=diff+' dit√´';}
    else{dStr=Math.abs(diff)+' dit√´ m√´ par√´';}
    li.innerHTML=`
      <div class="h-color-bar" style="background:${color}"></div>
      <div class="h-date">
        <div class="h-day">${String(h.date.getDate()).padStart(2,'0')}</div>
        <div class="h-month">${MS[h.date.getMonth()]}</div>
      </div>
      <div class="h-info">
        <div class="h-name">${h.name}</div>
        <div class="h-desc">${h.desc}</div>
        <span class="h-badge ${badgeCls}">${badge}</span>
      </div>
      <div class="${dCls}">${dStr}</div>`;
    list.appendChild(li);
  });
}

document.getElementById('prevBtn').onclick=()=>{ vM--;if(vM<0){vM=11;vY--;} render(); };
document.getElementById('nextBtn').onclick=()=>{ vM++;if(vM>11){vM=0;vY++;} render(); };

startCountdown();
renderMoon();
render();
</script>
</body>
</html>
